<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Alzod</title>
<style>
html, body, * {
    margin: 0px; padding: 0px; box-sizing: border-box;
}
a:link,
a:visited,
a:hover,
a:active {text-decoration: none; color: black;}
.none {display: none;}
.view_root {width:100vw; min-height:100vh;}
.loading_root {
    z-index: 99; position:fixed; top:0px; left:0px; width:100vw; height:100vw; 
    background: rgb(59, 153, 51);
}
.error_root {
    z-index: 100; position:fixed; top:0px; left:0px; width:100vw; height:100vw; 
    background: #e28484; cursor: pointer;
}
.error_text {padding-top:30vh; font-size:30px;}
.logo {display: block; height:50px; line-height: 50px;}
.logo svg {display: block; float:left;width:50px; height:50px; }
.logo span {display: block; float:left; font-size: 30px;}
.search_box {display: block; height:250px;}
.search_box input[type=textbox] {float:left;width:75vw; height:30px;}
.search_box input[type=submit] {float:left;width:15vw; line-height:30px;}
.icons_root {
    margin:0 auto; width:100vw; max-width:450px; text-align: center;
    overflow: hidden;
}
.icon_larg {
    float:left; margin:10px 25px; width:100px; height:100px; 
    border-radius:10px; background:#dcdcdc;
}
.icon_larg svg {display: block; margin: 0 auto; width:70px; height:70px;}
</style>
<link rel="icon" href="/static/demo_icon.gif" type="image/gif">
<script type="text/javascript">

window.onerror = function (message, url, line, column) {
    var e = "message=" + message;
    e += "&url=" + url;
    e += "&line=" + line;
    e += "&column=" + column;
    var request = new XMLHttpRequest();
    request.open("GET", "/?err=" + e, true);
    request.send(e);
    return false;
};


var Controller = {
    current_history: window.history.length,
    current_index: 1,
    initial_item: null,
    running: {},
    view: {},
    show: function(view) { Controller.running[view].show(); },
    remove: function(view) { Controller.running[view].remove(); },
    fetch: function(href, type, data) { 
        Controller.loading.show();
        // get from memory, if not fetch ... 
        Controller.model.fetch(href, type, data);
    },
    model: {
      fetch: function(href, type, data) {
        type = type || "get";
        type = type.toUpperCase();

        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if(this.readyState == 4 && this.status == 200) {
              try {
                var json_response = JSON.parse(request.responseText);
                if('type' in json_response) {
                  if('add' in Controller) {
                    json_response.href = href;
                    Controller.add(json_response);
                  }
                  else { Controller.error.show("add not found!"); }
                }
                else {
                  Controller.error.show('response does not contain type!');
                }
              }
              catch(error) {
                  Controller.error.show("JSON.parse: " + error);
              }
            }
            else if(this.readyState == 4) {
              Controller.error.show("model.fetch status: " + this.status);
            }
        };
        request.open(type, href, true);
        if(data === undefined) { request.send(data); }
        else {
            data = JSON.stringify(data);
            var Content_type = 'application/json; charset=utf-8';
            request.setRequestHeader('Content-type', Content_type);
            request.send();
        }
      }
    },
    loading: {
        show: function() {
            var loading_div = document.getElementById('loading_div');
            loading_div.setAttribute("class", "loading_root");
        },
        hide: function() {
            var loading_div = document.getElementById('loading_div');
            loading_div.setAttribute("class", "none");
        }
    },
    error: {
        display: false,
        show: function(html) {
            Controller.error.display = true;
            var error_div = document.getElementById('error_div');
            console.error(html);
            error_div.innerHTML = "<div class='error_text'>"+ html +"</div>";
            error_div.setAttribute("class", "error_root");
            // send error html to server ... 
        },
        hide: function() {
            Controller.error.display = false;
            var error_div = document.getElementById('error_div');
            error_div.innerHTML = "hide";
            error_div.setAttribute("class", "none");
            Controller.loading.hide();
        }
    }
};

document.onsubmit = function(event) {
    event.preventDefault();
    event.stopPropagation();
    // delete
    Controller.error.show("Form submit function not updated!");
};
</script>
</head>


<body>
<div id="loading_div" class="none">
    <div class="error_text">loading</div>
</div>

<div id="error_div" class="none" onclick="Controller.error.hide();">e</div>

<div id="all_views">
    <div id="view_home" class="view_root">
        <div class="logo">
            <svg viewBox="0 0 100 100" height="100" width="100">
                <circle cx="50" cy="50" r="40" fill="green" />
            </svg> 
            <span>Alzod</span>
        </div>

        <form class="search_box" action='/static/search.json' method='GET'>
            <input type="textbox" name="aaa" value="VALUE -{<>} aaa" placeholder="Search" />
            <input type="textbox" name="bbb" value="VALUE -{<>} bbb" placeholder="Search" />
            <input type="textbox" name="ccc" value="VALUE -{<>} ccc" placeholder="Search" />
            
            <textarea name='ttt'>Text area.. //\\/N/n\n bbbb</textarea>
            
            <select name="d_cars" size="4" multiple>
                <option value="volvo">Volvo</option>
                <option value="saab">Saab</option>
                <option value="fiat">Fiat</option>
                <option value="audi">Audi</option>
            </select>

            <input type="checkbox" name="vehicle1" value="Bike"> I have a bike<br>
            <input type="checkbox" name="vehicle2" value="Car"> I have a car<br>
            <input type="checkbox" name="vehicle3" value="Boat" checked> I have a boat<br>
            <input type="checkbox" name="vehicle3" value="Big Boat" checked> I have a big boat<br>
            <input type="submit" value="Search" />
        </form>

        <div class="icons_root">
            <a href="/static/itecm.json" title="المفضلة" class="icon_larg"
                onclick="Controller.fetch(this.href);return false;">
                <svg viewBox="0 0 100 100" height="100" width="100">
                    <circle cx="50" cy="50" r="40" fill="blue" />
                </svg> 
                <span>المفضلة</span>
            </a>

            <a href="/static/item.json" title="المفضلة" class="icon_larg"
                onclick="Controller.fetch(this.href);return false;">
                <svg viewBox="0 0 100 100" height="100" width="100">
                    <circle cx="50" cy="50" r="40" fill="yellow" />
                </svg> 
                <span>السلة</span>
            </a>

            <a href="/static/test.json" title="المفضلة" class="icon_larg"
                onclick="Controller.fetch(this.href);return false;">
                <svg viewBox="0 0 100 100" height="100" width="100">
                    <circle cx="50" cy="50" r="40" fill="gray" />
                </svg> 
                <span>تسجيل</span>
            </a>

            <a href="/static/error.json" title="المفضلة" class="icon_larg"
                onclick="Controller.fetch(this.href);return false;">
                <svg viewBox="0 0 100 100" height="100" width="100">
                    <circle cx="50" cy="50" r="40" fill="red" />
                </svg> 
                <span>Error</span>
            </a>
        </div>
    </div>
</div>

<script type="text/javascript">
    var initial_item = window.location.pathname.replace(/^\//, "");
    if(!isNaN(initial_item) && initial_item.length > 0) {
        Controller.initial_item = initial_item;
        Controller.fetch(initial_item);
    }
</script>
<link rel="stylesheet" type="text/css" href="/static/main.css">
<script src="/static/controller.js"></script>
<script src="/static/head.js"></script>
</body>
</html> 