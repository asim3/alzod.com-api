 <!DOCTYPE html>
<html>
<head>
    <title>Alzod</title>
    
    <style>
    html, body {margin: 0px; padding: 0px;}
    a:link,a:visited,a:hover,a:active {text-decoration: none; color: black;}
    .logo {display: block; height:50px; line-height: 50px;}
    .logo svg {display: block; float:left;width:50px; height:50px; }
    .logo span {display: block; float:left; font-size: 30px;}
    .search_box {display: block; height:50px;}
    .search_box input[type=textbox] {float:left;width:75vw; height:30px;}
    .search_box input[type=submit] {float:left;width:15vw; line-height:30px;}
    .apps_area {
        margin:115px auto 0 auto; width:100vw; max-width:450px; 
        overflow: hidden;
    }
    .icon_larg {
        float:left; margin:10px 25px; width:100px; height:100px; 
        border-radius:10px; background:#dcdcdc; text-align:center;
    }
    .icon_larg svg {display: block; margin: 0 auto; width:70px; height:70px;}
    </style>
    
    <script type="text/javascript">
    var RUNNING = [];
    var SCRIPTS = {};


    var fetch_script = function(obj) {
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.id = "js_script_" + obj.type;
        script.type = 'text/javascript';
        script.onload = function() { 
            if(obj.type in SCRIPTS) { run_app(obj); }
            else { console.error(obj.type + ' not in SCRIPTS object!'); }
        }
        script.onerror = function() { loading_page('hide'); }
        head.appendChild(script);
        script.src = "http://localhost:8000/static/"+ obj.type +".js";
    };
    

    var run_app = function(obj) {
        if(obj.type in SCRIPTS) {
            var div = document.createElement('div');
            div.id = "app_" + obj.id;
            var app = {
                "type": obj.type,
                "body": SCRIPTS[obj.type](obj),
                "show": function() {},
                "hide": function() {},
                "remove": function() {}
            }
            loading_page('hide');
            RUNNING.push(app)
            console.log(RUNNING)
        }
        else {
            fetch_script(obj);
        }
    };


    var find_href = function(node) {
        if('tagName' in node) {
            while (node.tagName != 'A') {
                node = node.parentNode; if(node == null) {break;}
            };
        }
        if(node != null) {
            if('href' in node) { return node.href; }
        }
        return null;
    };


    var loading_page = function(status) {
        console.log(status == 'hide' ? 'Done loading' : 'Loading..');
    };


    document.addEventListener("click", function(event){
        event.preventDefault();
        event.stopPropagation();
        var href = find_href(event.target);
        if(typeof href == 'string') {
            var request = new XMLHttpRequest();
            request.onreadystatechange = function() {
                if(this.readyState == 4 && this.status == 200) {
                    var json_response = JSON.parse(request.responseText)
                    if('type' in json_response) {
                        run_app(json_response);
                    }
                    else { 
                        console.error('response does not contain type object!');
                        loading_page('hide');
                    }
                }
                else if(this.readyState == 4) {
                    loading_page('hide');
                }
            };
            request.open("GET", href);
            loading_page();
            request.send();
        }
    });
    </script>
</head>


<body>
    <div class="logo">
        <svg viewBox="0 0 100 100" height="100" width="100">
            <circle cx="50" cy="50" r="40" fill="green" />
        </svg> 
        <span>Alzod</span>
    </div>

    <form class="search_box" action='/' method='get'>
        <input type="textbox" name="s" placeholder="Look for what you want" />
        <input type="submit" value="Search" />
    </form>

    <div class="apps_area">
        <a href="/static/item.json" class="icon_larg">
            <svg viewBox="0 0 100 100" height="100" width="100">
                <circle cx="50" cy="50" r="40" fill="blue" />
            </svg> 
            <span>المفضلة</span>
        </a>

        <a href="/static/test.json" class="icon_larg">
            <svg viewBox="0 0 100 100" height="100" width="100">
                <circle cx="50" cy="50" r="40" fill="yellow" />
            </svg> 
            <span>السلة</span>
        </a>

        <a href="/static/test.json" class="icon_larg">
            <svg viewBox="0 0 100 100" height="100" width="100">
                <circle cx="50" cy="50" r="40" fill="red" />
            </svg> 
            <span>تسجيل</span>
        </a>
    </div>
</body>
</html> 